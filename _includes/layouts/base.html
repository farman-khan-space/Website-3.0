<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} | Farman Khan - Data Analyst</title>
   
    <script>
      (function() {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- This is the crucial line that fixes the CSS path -->
    <link rel="stylesheet" href="{{ '/css/style.css' | url }}">
</head>
<body>
    <header>
        {% include "partials/header.html" %}
    </header>

    <main>
        {{ content | safe }}
    </main>

    {% include "partials/footer.html" %}

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const updateActiveNavLink = () => {
                const navLinks = document.querySelectorAll('#main-nav a');
                if (!navLinks.length) return;
                const currentPath = window.location.pathname;
                navLinks.forEach(link => {
                    const linkPath = new URL(link.href).pathname;
                    link.classList.remove('active');
                    if (linkPath === currentPath || (linkPath.endsWith('/') && currentPath.replace(/\/$/, "") === linkPath.slice(0, -1))) {
                        link.classList.add('active');
                    } else if (link.getAttribute('href').includes('portfolio') && currentPath.includes('/projects/')) {
                        link.classList.add('active');
                    } else if (link.getAttribute('href').includes('blog') && currentPath.includes('/posts/')) {
                        link.classList.add('active');
                    }
                });
            };
            const initializeTheme = () => {
                const themeToggleButton = document.getElementById('theme-toggle-floating');
                if (!themeToggleButton) return;
                const htmlEl = document.documentElement; 
                themeToggleButton.addEventListener('click', () => {
                    htmlEl.classList.toggle('dark');
                    const theme = htmlEl.classList.contains('dark') ? 'dark' : 'light';
                    localStorage.setItem('theme', theme);
                });
            };
            const initializeMobileMenu = () => {
                const menuToggle = document.getElementById('menu-toggle');
                if (!menuToggle) return;
                menuToggle.addEventListener('click', () => {
                    const isNavOpen = document.body.classList.toggle('nav-open');
                    menuToggle.setAttribute('aria-expanded', isNavOpen);
                });
            };
            const initializeScrollToTop = () => {
                const scrollToTopButton = document.getElementById('scroll-to-top');
                if (!scrollToTopButton) return;
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 500) {
                        scrollToTopButton.classList.add('visible');
                    } else {
                        scrollToTopButton.classList.remove('visible');
                    }
                });
                scrollToTopButton.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            };
            initializeTheme();
            initializeMobileMenu();
            updateActiveNavLink();
            initializeScrollToTop();
        });
    </script>
</body>
</html>
